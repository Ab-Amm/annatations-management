<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Annotation Task</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .annotation-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 20px;
        }
        .text-pair {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        .class-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }
        .progress-container {
            margin-bottom: 2rem;
        }
    </style>
</head>

<body>
<a th:href="@{/annotator/tasks}" class="btn btn-success">
    Return to Task List
</a>
<div class="annotation-container" th:object="${task}">
    <!-- Progress Bar -->
    <div class="progress-container">
        <h4>Annotation Progress</h4>
        <div class="progress">
            <div class="progress-bar" role="progressbar"
                 th:style="'width: ' + ${progressPercentage} + '%'"
                 th:text="${task.couplesDone} + '/' + ${totalCouples}">
            </div>
        </div>
    </div>

    <!-- Navigation Controls -->
    <div class="navigation-controls">
        <!-- Previous Button -->
        <a th:if="${currentIndex > 0}"
           th:href="@{/annotator/tasks/annotateTask/{taskId}/navigate(taskId=${task.id}, newIndex=${currentIndex - 1})}"
           class="btn btn-secondary">
            Previous
        </a>

        <!-- Next Button -->
        <a th:if="${currentIndex < totalCouples - 1}"
           th:href="@{/annotator/tasks/annotateTask/{taskId}/navigate(taskId=${task.id}, newIndex=${currentIndex + 1})}"
           class="btn btn-secondary">
            Next
        </a>
    </div>

    <!-- Current Text Pair -->
    <div class="text-pair" th:if="${currentCouple}">
        <div class="mb-4">
            <h5>Text 1</h5>
            <p th:text="${currentCouple.text1}"></p>
        </div>
        <div class="mb-4">
            <h5>Text 2</h5>
            <p th:text="${currentCouple.text2}"></p>
        </div>

        <!-- Class Selection Form -->
        <form th:action="@{/annotator/tasks/annotateTask/{taskId}(taskId=${task.id})}" method="post">
            <input type="hidden" name="coupleId" th:value="${currentCouple.id}">
            <input type="hidden" name="currentIndex" th:value="${currentIndex}">

            <!-- Class selection radio buttons -->
            <div class="class-options">
                <div th:each="classe : ${task.dataset.classesPossible}">
                    <div class="form-check">
                        <label>
                            <input class="form-check-input"
                                   type="radio"
                                   name="selectedClass"
                                   th:id="${classe.touteClasse}"
                                   th:value="${classe.touteClasse}"
                                   th:checked="${currentAnnotation?.chosenClass == classe.touteClasse}" required>
                        </label>
                        <label class="form-check-label" th:for="${classe.touteClasse}">
                            [[${classe.touteClasse}]]
                        </label>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn btn-primary">Validate</button>
        </form>
    </div>

    <!-- Completion Message -->
    <div th:unless="${currentCouple}" class="alert alert-success">
        <h4>Annotation Complete! ðŸŽ‰</h4>
        <p>You've finished all text pairs in this task.</p>
        <a th:href="@{/annotator/tasks}" class="btn btn-success">
            Return to Task List
        </a>
    </div>
</div>
</body>
</html>